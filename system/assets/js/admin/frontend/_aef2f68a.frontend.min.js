!function(a){a.alert=function(b){var c={type:"success",message:"",sticky:!1};b=a.extend(c,b),b.type=b.type.toLowerCase(),"undefined"==typeof b.title&&(b.title=i18n.translateResource("cms:frontendadmin."+b.type+".alert.title")),a.gritter.add({title:b.title,text:b.message,class_name:"gritter-"+b.type+" preside-frontend-msgbox",sticky:b.sticky})}}(presideJQuery),function(a){var b,c,d,e=a("#preside-admin-toolbar"),f=a("body"),g=a(".content-editor"),h=!1;if(b=function(){g.each(function(){var b=a(this),c=b.find(".content-editor-overlay .inner");c.width(b.outerWidth(!0)),c.height(b.outerHeight(!0)),c.height()<60&&c.height(60)})},c=function(c){h=c,c?(f.addClass("show-frontend-editors"),b()):f.removeClass("show-frontend-editors"),a.cookie("_presideEditMode",c?"true":"false")},d=function(){var b=a("#edit-mode-options"),c=b.prop("checked"),d=!c;b.prop("checked",d),b.trigger("change")},e.on("click change","#edit-mode-options",function(){var b=a(this);c(b.prop("checked"))}),f.keydown("e",function(a){userIsTyping()||(a.preventDefault(),d())}),a(window).resize(function(){b()}),setInterval(function(){h&&b()},200),"undefined"!=typeof a.cookie("_presideEditMode")){var i=a.cookie("_presideEditMode"),j=a("#edit-mode-options"),k="true"==i;j.prop("checked",k),c(k)}if(g.length){var l=function(){var b=0;return a("[tabindex]").each(function(){var c=parseInt(a(this).attr("tabindex"));!isNaN(c)&&c>b&&(b=c)}),b+1}();f.attr("data-nav-list","1"),f.data("navListChildSelector",".content-editor"),g.each(function(b){a(this).attr("tabindex",l+b)}),f.append('<div class="frontend-editor-modal-sheen"></div>')}a.fn.presideFrontEndEditor=function(){return this.each(function(){var c,d,e,g,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=a(this),x=w.find(".content-editor-editor-container"),y=(w.find(".content-editor-overlay .inner"),x.find("form")),z=y.find("[name=content]"),A=x.find("textarea[name=draftContent]"),B=w.find(".content-editor-content"),C=w.find(".content-editor-editor-notifications"),D=w.hasClass("richeditor"),E=y.attr("action"),F=y.data("saveDraftAction"),G=y.data("discardDraftAction"),H=z.val(),I=A.length&&A.val().length?A.val():H,J=!1,K=1500,L=null,M='<i class="preside-icon fa fa-trash-o discard-draft" title="'+i18n.translateResource("cms:frontendeditor.discard.draft.link")+'"></i> ';x.appendTo("body"),d=function(a){J=a,a?(window.addEventListener("beforeunload",r,!1),x.addClass("edit-active"),f.addClass("frontend-editors-editing"),D?t():v()):(window.removeEventListener("beforeunload",r,!1),D&&u(),x.removeClass("edit-active"),f.removeClass("frontend-editors-editing")),b()},t=function(){w.data("_rawContent",z.val()),A.val().length&&(j(M+i18n.translateResource("cms:frontendeditor.draft.loaded.notification")),z.val(A.val())),c=new PresideRichEditor(z.get(0)).editor,c.on("change",function(){e()}),c.on("instanceReady",function(b){H===I?H=b.editor.getData():I=b.editor.getData(),e(),b.editor.focus(),a("html, body").scrollTop(w.offset().top-20)}),c.on("key",function(a){var b=a.data.keyCode,e=27,f=13+CKEDITOR.CTRL,g=13+CKEDITOR.ALT;if(J){if(b===e)return d(!1),!1;if(b===f&&q())return i(),!1;if(b===g)return c.execCommand("maximize"),!1;null!==L&&window.clearTimeout(L),L=window.setTimeout(m,K)}})},u=function(){m(),z.val(w.data("_rawContent")),s(),c.destroy()},v=function(){z.on("change keyup click focus blur",function(){e()}),z.focus()},s=function(){"undefined"!=typeof c.commands.maximize&&1===c.commands.maximize.state&&c.execCommand("maximize")},p=function(){return c.getData()!=I&&c.getData()!=H},q=function(){return!0},e=function(){J&&(x.find(".editor-btn-save").prop("disabled",!q()),D&&x.find(".editor-btn-draft").prop("disabled",!p()))},j=function(a){C.html(a)},k=function(){j("")},l=function(a){"undefined"==typeof a&&(a=!0),J=!a,y.prop("disabled",a),y.find(":input").prop("disabled",a),a||e()},i=function(){D&&s(),confirm(i18n.translateResource("cms:frontendeditor.confirm.save.prompt"))?g():c.focus()},g=function(b){var e,f;b=a.extend({draft:!1,url:E},b),D&&(z.val(c.getData()),b.draft||w.data("_rawContent",z.val())),f=z.val(),e=y.serializeArray(),j(b.draft?i18n.translateResource("cms:frontendeditor.saving.draft.notification"):i18n.translateResource("cms:frontendeditor.saving.notification")),l(),a.post(b.url,e,function(c){c.success&&(b.draft||"undefined"!=typeof c.rendered)?(I=f,b.draft?(A.val(f),w.addClass("has-draft"),j(M+i18n.translateResource("cms:frontendeditor.saved.draft.notification",{data:[a.dateformat.date(new Date,"HH:mm:ss")]}))):(H=f,B.html(c.rendered),d(!1),D&&o(),c.message&&a.alert({message:c.message}))):a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(a){b.draft&&a.success||k(),l(!1)})},n=function(){j(M+i18n.translateResource("cms:frontendeditor.discarding.draft.notification")),a.post(G,y.serializeArray(),function(b){b.success?(o(),b.message&&a.alert({message:b.message})):a.alert(b.error?{type:"error",message:b.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(){k()})},o=function(){A.val(""),z.val(w.data("_rawContent")),w.removeClass("has-draft"),H=I=z.val(),c.setData(H),e()},m=function(){p()&&g({draft:!0,url:F})},r=function(){return m(),q()?i18n.translateResource("cms:frontendeditor.browser.exit.warning"):void 0},w.on("click",".content-editor-overlay,.content-editor-label",function(a){a.preventDefault(),d(!0)}),x.keydown("return",function(a){h&&(a.preventDefault(),d(!0))}),x.on("click",".editor-btn-cancel",function(a){a.preventDefault(),d(!1)}),x.on("click",".editor-btn-save",function(a){a.preventDefault(),i()}),x.on("click",".editor-btn-draft",function(a){a.preventDefault(),g({draft:!0,url:F})}),x.on("click",".discard-draft",function(a){a.preventDefault(),n()}),x.on("submit",".content-editor-form",function(a){a.preventDefault()})})},g.presideFrontEndEditor()}(presideJQuery);
//# sourceMappingURL=_frontend.min.map