!function(a){a.alert=function(b){var c={type:"success",message:"",sticky:!1};b=a.extend(c,b),b.type=b.type.toLowerCase(),"undefined"==typeof b.title&&(b.title=i18n.translateResource("cms:frontendadmin."+b.type+".alert.title")),a.gritter.add({title:b.title,text:b.message,class_name:"gritter-"+b.type+" preside-frontend-msgbox",sticky:b.sticky})}}(presideJQuery),function(a){var b,c,d,e,f=a("#preside-admin-toolbar"),g=a("body"),h=a(".content-editor"),i=[],j=!1;if(b=function(){h.each(function(){var b,c=a(this),d=c.find(".content-editor-overlay .inner"),e=c.data("parent"),f=c.attr("id"),g="container: "+f,h="!"+g,j={},k=a("<div></div>"),l=a("<div></div>");"undefined"!=typeof e&&(e.contents().filter(function(){return 8===this.nodeType}).each(function(){a.trim(this.nodeValue)===g?a(this).before(k):a.trim(this.nodeValue)===h&&(b=a(this),b.after(l))}),j.width=k.width(),j.top=k.offset().top+k.height(),j.left=k.offset().left,j.height=l.offset().top-j.top,j.height<25&&(i.push(a("<div></div>").height(25-j.height)),b.before(i[i.length-1]),j.height=25),k.remove(),l.remove(),c.css({top:j.top+"px",left:j.left+"px"}),c.width(j.width),c.height(j.height),d.width(c.outerWidth(!0)),d.height(c.outerHeight(!0)))})},c=function(){for(;i.length;){try{i[0].remove()}catch(a){}i.shift()}},d=function(d){j=d,d?(g.addClass("show-frontend-editors"),b()):(g.removeClass("show-frontend-editors"),c()),a.cookie("_presideEditMode",d?"true":"false")},e=function(){var b=a("#edit-mode-options"),c=b.prop("checked"),d=!c;b.prop("checked",d),b.trigger("change")},f.on("click change","#edit-mode-options",function(){var b=a(this);d(b.prop("checked"))}),g.keydown("e",function(a){userIsTyping()||(a.preventDefault(),e())}),a(window).resize(function(){b()}),setInterval(function(){j&&b()},200),"undefined"!=typeof a.cookie("_presideEditMode")){var k=a.cookie("_presideEditMode"),l=a("#edit-mode-options"),m="true"==k;l.prop("checked",m),d(m)}if(h.length){var n=function(){var b=0;return a("[tabindex]").each(function(){var c=parseInt(a(this).attr("tabindex"));!isNaN(c)&&c>b&&(b=c)}),b+1}();g.attr("data-nav-list","1"),g.data("navListChildSelector",".content-editor"),h.each(function(b){a(this).attr("tabindex",n+b)}),g.append('<div class="frontend-editor-modal-sheen"></div>')}a.fn.presideFrontEndEditor=function(){return this.each(function(){var c,d,e,f,h,i,k,l,m,n,o,p,q,r,s,t,u,v,w,x=a(this),y=x.find(".content-editor-editor-container"),z=(x.find(".content-editor-overlay .inner"),y.find("form")),A=z.find("[name=content]"),B=y.find("textarea[name=draftContent]"),C=x.parent(),D=x.find(".content-editor-editor-notifications"),E=x.hasClass("richeditor"),F=z.attr("action"),G=z.data("saveDraftAction"),H=z.data("discardDraftAction"),I=A.val(),J=B.length&&B.val().length?B.val():I,K=!1,L=1500,M=null,N='<i class="preside-icon fa fa-trash-o discard-draft" title="'+i18n.translateResource("cms:frontendeditor.discard.draft.link")+'"></i> ';x.appendTo("body"),x.data("parent",C),y.appendTo("body"),d=function(a){K=a,a?(window.addEventListener("beforeunload",r,!1),y.addClass("edit-active"),g.addClass("frontend-editors-editing"),E?t():v()):(window.removeEventListener("beforeunload",r,!1),E&&u(),y.removeClass("edit-active"),g.removeClass("frontend-editors-editing")),b()},t=function(){x.data("_rawContent",A.val()),B.val().length&&(i(N+i18n.translateResource("cms:frontendeditor.draft.loaded.notification")),A.val(B.val())),c=new PresideRichEditor(A.get(0)).editor,c.on("change",function(){e()}),c.on("instanceReady",function(b){I===J?I=b.editor.getData():J=b.editor.getData(),e(),b.editor.focus(),a("html, body").scrollTop(x.offset().top-20)}),c.on("key",function(a){var b=a.data.keyCode,e=27,f=13+CKEDITOR.CTRL,g=13+CKEDITOR.ALT;if(K){if(b===e)return d(!1),!1;if(b===f&&q())return h(),!1;if(b===g)return c.execCommand("maximize"),!1;null!==M&&window.clearTimeout(M),M=window.setTimeout(m,L)}})},u=function(){m(),A.val(x.data("_rawContent")),s(),c.destroy()},v=function(){A.on("change keyup click focus blur",function(){e()}),A.focus()},s=function(){"undefined"!=typeof c.commands.maximize&&1===c.commands.maximize.state&&c.execCommand("maximize")},p=function(){return c.getData()!=J&&c.getData()!=I},q=function(){return!0},e=function(){K&&(y.find(".editor-btn-save").prop("disabled",!q()),E&&y.find(".editor-btn-draft").prop("disabled",!p()))},i=function(a){D.html(a)},k=function(){i("")},l=function(a){"undefined"==typeof a&&(a=!0),K=!a,z.prop("disabled",a),z.find(":input").prop("disabled",a),a||e()},h=function(){E&&s(),confirm(i18n.translateResource("cms:frontendeditor.confirm.save.prompt"))?f():c.focus()},w=function(b){for(var c,d,e=C.contents(),f=x.attr("id"),g="container: "+f,h="!"+g,i=0,j=e.length,k=!1;j>i;i++)if(c=e[i],k||8!==c.nodeType||a.trim(c.nodeValue)!==g){if(k){if(8===c.nodeType&&a.trim(c.nodeValue)===h)break;a(c).remove()}}else k=!0,d=a(c);"undefined"!=typeof d&&d.after(b)},f=function(b){var e,f;b=a.extend({draft:!1,url:F},b),E&&(A.val(c.getData()),b.draft||x.data("_rawContent",A.val())),f=A.val(),e=z.serializeArray(),i(b.draft?i18n.translateResource("cms:frontendeditor.saving.draft.notification"):i18n.translateResource("cms:frontendeditor.saving.notification")),l(),a.post(b.url,e,function(c){c.success&&(b.draft||"undefined"!=typeof c.rendered)?(J=f,b.draft?(B.val(f),x.addClass("has-draft"),i(N+i18n.translateResource("cms:frontendeditor.saved.draft.notification",{data:[a.dateformat.date(new Date,"HH:mm:ss")]}))):(I=f,w(c.rendered),d(!1),E&&o(),c.message&&a.alert({message:c.message}))):a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(a){b.draft&&a.success||k(),l(!1)})},n=function(){i(N+i18n.translateResource("cms:frontendeditor.discarding.draft.notification")),a.post(H,z.serializeArray(),function(b){b.success?(o(),b.message&&a.alert({message:b.message})):a.alert(b.error?{type:"error",message:b.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).fail(function(b){var c=b.responseJSON||{};a.alert(c.error?{type:"error",message:c.error,sticky:!0}:{type:"error",message:i18n.translateResource("cms:frontendeditor.save.unknown.error"),sticky:!0})}).always(function(){k()})},o=function(){B.val(""),A.val(x.data("_rawContent")),x.removeClass("has-draft"),I=J=A.val(),c.setData(I),e()},m=function(){p()&&f({draft:!0,url:G})},r=function(){return m(),q()?i18n.translateResource("cms:frontendeditor.browser.exit.warning"):void 0},x.on("click",".content-editor-overlay,.content-editor-label",function(a){a.preventDefault(),d(!0)}),y.keydown("return",function(a){j&&(a.preventDefault(),d(!0))}),y.on("click",".editor-btn-cancel",function(a){a.preventDefault(),d(!1)}),y.on("click",".editor-btn-save",function(a){a.preventDefault(),h()}),y.on("click",".editor-btn-draft",function(a){a.preventDefault(),f({draft:!0,url:G})}),y.on("click",".discard-draft",function(a){a.preventDefault(),n()}),y.on("submit",".content-editor-form",function(a){a.preventDefault()})})},h.presideFrontEndEditor()}(presideJQuery);
//# sourceMappingURL=_frontend.min.map